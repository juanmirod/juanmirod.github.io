(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();function P(e,n,t){document.addEventListener("keydown",s=>{s.key==="ArrowLeft"?e(-1):s.key==="ArrowRight"?e(1):s.key==="ArrowDown"?n():s.key==="q"||s.key==="Q"?t(-1):(s.key==="w"||s.key==="W"||s.key==="ArrowUp")&&t(1)});const i=document.getElementById("left"),o=document.getElementById("right"),l=document.getElementById("rotate"),c=document.getElementById("down");i.addEventListener("click",()=>{e(-1)}),o.addEventListener("click",()=>{e(1)}),l.addEventListener("click",()=>{t(1)});let d;c.addEventListener("mousedown",()=>{n(),d=setInterval(n,100)}),c.addEventListener("mouseup",()=>{clearInterval(d)}),c.addEventListener("mouseleave",()=>{clearInterval(d)}),c.addEventListener("touchstart",s=>{s.preventDefault(),n(),d=setInterval(n,100)}),c.addEventListener("touchend",()=>{clearInterval(d)})}const O=[null,"#FF0D72","#0DC2FF","#0DFF72","#F538FF","#FF8E0D","#FFE138","#3877FF"],A={T:[[0,0,0],[1,1,1],[0,1,0]],O:[[2,2],[2,2]],L:[[0,3,0],[0,3,0],[0,3,3]],J:[[0,4,0],[0,4,0],[4,4,0]],I:[[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]],S:[[0,6,6],[6,6,0],[0,0,0]],Z:[[7,7,0],[0,7,7],[0,0,0]]};function w(e){return A[e]}const u="ILJOTSZ";function h(e,n,t){n.forEach((i,o)=>{i.forEach((l,c)=>{l!==0&&(e.fillStyle=O[l],e.fillRect(c+t.x,o+t.y,1,1))})})}function T(e,n,t,i){e.fillStyle="#000",e.fillRect(0,0,n.width,n.height),h(e,t,{x:0,y:0}),h(e,i.matrix,i.pos)}function W(e,n,t){e.fillStyle="#000",e.fillRect(0,0,n.width,n.height);const i=t.nextPiece,o={x:n.width/20/2-i[0].length/2,y:n.height/20/2-i.length/2};h(e,i,o)}function C(e,n){const t=[];for(;n--;)t.push(new Array(e).fill(0));return t}function N(e){let n=0;e:for(let t=e.length-1;t>=0;--t){for(let o=0;o<e[t].length;++o)if(e[t][o]===0)continue e;const i=e.splice(t,1)[0].fill(0);e.unshift(i),++t,n++}return n}function a(e,n){const[t,i]=[n.matrix,n.pos];for(let o=0;o<t.length;++o)for(let l=0;l<t[o].length;++l)if(t[o][l]!==0&&(e[o+i.y]&&e[o+i.y][l+i.x])!==0)return!0;return!1}function R(e,n){n.matrix.forEach((t,i)=>{t.forEach((o,l)=>{o!==0&&(e[i+n.pos.y][l+n.pos.x]=o)})})}function b(e){e.forEach(n=>n.fill(0))}const x=document.getElementById("tetris"),v=x.getContext("2d"),L=document.getElementById("next-piece"),I=L.getContext("2d");v.scale(20,20);I.scale(20,20);function q(e){let n=0,t=1;for(let i=0;i<e;i++)n+=t*10,t*=2;return n}function D(){const e=N(f);e>0&&(r.score+=q(e),r.lines+=e,r.lines>=10&&(r.level++,r.lines=0,g*=.9,k()))}function F(){r.pos.y++,a(f,r)&&(r.pos.y--,R(f,r),B(),D(),p()),m=0}function J(e){r.pos.x+=e,a(f,r)&&(r.pos.x-=e)}function B(){r.matrix=r.nextPiece,r.nextPiece=w(u[u.length*Math.random()|0]),r.pos.y=0,r.pos.x=(f[0].length/2|0)-(r.matrix[0].length/2|0),a(f,r)&&(b(f),r.score=0,r.level=1,r.lines=0,g=1e3,p(),k()),W(I,L,r)}function M(e){const n=r.pos.x;let t=1;for(y(r.matrix,e);a(f,r);)if(r.pos.x+=t,t=-(t+(t>0?1:-1)),t>r.matrix[0].length){y(r.matrix,-e),r.pos.x=n;return}}function y(e,n){for(let t=0;t<e.length;++t)for(let i=0;i<t;++i)[e[i][t],e[t][i]]=[e[t][i],e[i][t]];n>0?e.forEach(t=>t.reverse()):e.reverse()}let m=0,g=1e3,E=0;function S(e=0){const n=e-E;E=e,m+=n,m>g&&F(),T(v,x,f,r),requestAnimationFrame(S)}function p(){document.getElementById("score").innerText=r.score}function k(){document.getElementById("level").innerText=r.level}const f=C(12,20),r={pos:{x:0,y:0},matrix:null,nextPiece:null,score:0,level:1,lines:0};P(J,F,M);r.nextPiece=w(u[u.length*Math.random()|0]);B();p();S();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered with scope: ",e.scope)}).catch(e=>{console.log("Service Worker registration failed: ",e)})});
